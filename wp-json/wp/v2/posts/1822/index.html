{"id":1822,"date":"2019-12-06T11:57:40","date_gmt":"2019-12-06T16:57:40","guid":{"rendered":"https:\/\/ricardoromo.co\/?p=1822"},"modified":"2021-07-17T11:14:35","modified_gmt":"2021-07-17T16:14:35","slug":"crea-una-servidor-de-sala-de-chat-en-c-cliente","status":"publish","type":"post","link":"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c-cliente\/","title":{"rendered":"Como crear una Sala de Chat en C \u2013 Cliente"},"content":{"rendered":"<div class='booster-block booster-read-block'>\r\n                <div class=\"twp-read-time\">\r\n                \t<i class=\"booster-icon twp-clock\"><\/i> <span>Tiempo de lectura:<\/span>4 Minutos, 36 Segundos                <\/div>\r\n\r\n            <\/div>\n<h2 class=\"has-text-align-center\">Creando el cliente<\/h2>\n\n\n\n<p>El cliente es quien se conectar\u00e1 al servidor, quien enviar\u00e1 mensajes y recibir\u00e1 mensajes de otros clientes. En principio como debe ser una sala de chat. <\/p>\n\n\n\n<h3>Librer\u00edas:<\/h3>\n\n\n\n<p>Algunas de las librer\u00edas que estaremos utilizando seran estas: <\/p>\n\n\n\n<p class=\"has-text-align-justify\"><a href=\"https:\/\/es.wikipedia.org\/wiki\/Stdio.h\"><strong>#include &lt;stdio.h&gt; <\/strong><\/a>&#8211; Contiene las definiciones de las macros, las constantes, las declaraciones de funciones de la biblioteca est\u00e1ndar del lenguaje de programaci\u00f3n C para hacer operaciones, est\u00e1ndar, de entrada y salida. <\/p>\n\n\n\n<p class=\"has-text-align-justify\"><a href=\"https:\/\/es.wikipedia.org\/wiki\/Stdlib.h\"><strong>#include &lt;stdlib.h&gt; <\/strong><\/a>&#8211; Biblioteca est\u00e1ndar de prop\u00f3sito general del lenguaje de programaci\u00f3n C. Contiene los prototipos de funciones de C para gesti\u00f3n de memoria din\u00e1mica, control de procesos y otras. <\/p>\n\n\n\n<p class=\"has-text-align-justify\"><a href=\"https:\/\/es.wikipedia.org\/wiki\/String.h\"><strong>#include &lt;string.h&gt; <\/strong><\/a>&#8211; Contiene algunas funciones y tipos y algunas operaciones de manipulaci\u00f3n de memoria. <\/p>\n\n\n\n<p class=\"has-text-align-justify\"><strong>#include <\/strong>&lt;unistd.h&gt; &#8211; Define constantes y tipos simb\u00f3licos miscel\u00e1neos, y declara funciones miscel\u00e1neas. <\/p>\n\n\n\n<p><strong>#include &lt;sys\/types.h&gt;<\/strong> &#8211; Define algunos tipos adicionales. <\/p>\n\n\n\n<p class=\"has-text-align-justify\"><strong>#include &lt;sys\/socket.h&gt;<\/strong> &#8211; Define alguno tipos y macros para establecer una conexi\u00f3n con otro ordenador que nos permitir\u00e1 intercambiar datos.<\/p>\n\n\n\n<p> <strong>#include &lt;netinet\/in.h&gt; <\/strong><\/p>\n\n\n\n<p><strong>#include &lt;arpa\/inet.h&gt;<\/strong><\/p>\n\n\n\n<p><strong> #include  &lt;pthread.h&gt; <\/strong>&#8211; Define algunas funciones y tipos para manejar procesos hijos o hilos dentro de nuestros programas. <\/p>\n\n\n\n<p><strong>#include &#8220;commons.h&#8221;<\/strong> &#8211; define algunas funciones comunes que utilizaremos en el proyecto. <\/p>\n\n\n\n<h3>Funciones:<\/h3>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">void emisor(); \/\/maneja los mensajes de entrada \nvoid receptor(); \/\/maneja los mensajes de entrada \nint main(int argc, char **argv);\n<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Las funciones del codigo del cliente se explican por s\u00ed solas, tendremos un proceso central en el main que ser\u00e1 el encargado de configurar y establecer inicialmente una conexi\u00f3n con el servidor, mientras que las otras funciones son hilos apartes encargados de manejar los mensajes entrantes y salientes.<\/p>\n\n\n\n<h3>Funci\u00f3n main<\/h3>\n\n\n\n<p class=\"has-text-align-justify\">La primera parte, la definici\u00f3n misma de la funci\u00f3n y tal vez muchos iniciados en el lenguaje nunca la hayan visto, son esos dos argumentos de la funci\u00f3n.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">int main(int argc, char **argv)\n<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Y es de saber que la funci\u00f3n recibe dos par\u00e1metros, un n\u00famero y un array de punteros a caracteres. Estos argumentos vienen desde cuando se ejecuta el programa desde una consola y se le pasan lo que llamamos argumentos del sistema.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"215\" src=\"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2021\/07\/Argumentos-del-sistema.jpg?resize=640%2C215\" alt=\"\" class=\"wp-image-2244\" srcset=\"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2021\/07\/Argumentos-del-sistema.jpg?w=742 742w, https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2021\/07\/Argumentos-del-sistema.jpg?resize=300%2C101 300w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p>De esta manera al ejecutar la linea \u201c.\/client 8000\u201d le estariamos mandando los siguientes datos a la funci\u00f3n main.&nbsp;<\/p>\n\n\n\n<figure class=\"wp-block-table\"><table><tbody><tr><td>argc<\/td><td>argv<\/td><\/tr><tr><td>2<\/td><td>[\u201c.\/client\u201d,\u201d8000\u201d]<\/td><\/tr><\/tbody><\/table><\/figure>\n\n\n\n<p class=\"has-text-align-justify\">Una vez aclaramos esto, utilizamos esta funci\u00f3n, para pasarle directamente el puerto de la m\u00e1quina al que queremos que se conecte.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">if (argc != 2)\n    {\n        printf(\"Uso: %s \\n\", argv[0]);\n        return EXIT_FAILURE;\n    }\n \n    char *ip = \"127.0.0.1\";\n    int port = atoi(argv[1]); \/\/Convierte string a int<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Se define la ip del servidor, que como estamos en la misma m\u00e1quina, es la ip local y procedemos a configurar la conexi\u00f3n del socket.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">struct sockaddr_in server_addr;\n \n\/\/ Configuracion del Socket \nsockfd = socket(AF_INET, SOCK_STREAM, 0);\nserver_addr.sin_family = AF_INET;\nserver_addr.sin_addr.s_addr = inet_addr(ip);\nserver_addr.sin_port = htons(port);<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Todas estas son configuraciones necesarias a la hora de conectarnos a la red ya sea local, entre varias m\u00e1quinas o a la internet.\n\nEntonces estar\u00eda listo para conectarse:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">int err = connect(sockfd, (struct sockaddr *)&amp;server_addr, sizeof(server_addr));\nif (err == -1)\n{\n   printf(\"ERROR: conectando\\n\");\n   return EXIT_FAILURE;\n}\n<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Connect es una librer\u00eda de socket que intenta establecer una conexi\u00f3n a la direcci\u00f3n ip y el puerto que se le designaron, si la conexi\u00f3n es fallida, devuelve un -1. Una vez exitosa la conexi\u00f3n se lleva a cabo el primer mensaje al servidor, que es el nombre de usuario que se pidi\u00f3 anteriormente. Se crean 2 hilos para manejar tanto las comunicaciones entrantes y salientes.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">send(sockfd, name, 32, 0);\n \nprintf(\"=== Bienvenido a la sala de chat ===\\n\");\npthread_t hilo_emisor; \/\/Creacion del hilo emisor\n \nif (pthread_create(&amp;hilo_emisor, NULL, (void *)emisor, NULL) != 0)\n{\n    printf(\"ERROR: pthread  - Hilo del emisor\\n\");\n    return EXIT_FAILURE;\n}\n \npthread_t hilo_receptor; \/\/Creacion del hilo receptor\nif (pthread_create(&amp;hilo_receptor, NULL, (void *)receptor, NULL) != 0)\n{\n    printf(\"ERROR: pthread - Hilo del receptor\\n\");\n    return EXIT_FAILURE;\n}\n<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Ya al final este proceso quedar\u00e1 en un bucle infinito y para desconectarse del chat ser\u00e1 con Ctrl+C.<\/p>\n\n\n\n<h3>Funci\u00f3n Emisor<\/h3>\n\n\n\n<p class=\"has-text-align-justify\">Una vez establecida la conexi\u00f3n con el servidor el hilo emisor llama a la funci\u00f3n emisor y esperar\u00e1 hasta que el usuario realice una entrada en el teclado.\n<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">void emisor()\n{\n    char message[LENGTH] = {};\n    char buffer[LENGTH + 32] = {};\n \n \n    while (1)\n    {\n        memset(message, 0, LENGTH); \/\/resetea el buffer de mensajes\n        memset(buffer, 0, LENGTH+32); \/\/resetea el buffer de mensajes\n        reset_stdout();  \/\/ Vac\u00eda el b\u00fafer de salida.\n \n        fgets(message, LENGTH, stdin); \/\/captura el mensaje del usuario\n        \n        message[strcspn(message, \"\\n\")] = '\\0'; \/\/elimina los saltos de linea\n        \n        sprintf(buffer, \"%s-> %s\\n\", name, message);\n        \n        send(sockfd, buffer, strlen(buffer), 0); \/\/envia el mensaje all servidor\n    }\n}\n<\/pre>\n\n\n\n<h3>Funci\u00f3n Receptor<\/h3>\n\n\n\n<p class=\"has-text-align-justify\">Este hilo constantemente est\u00e1 comprobando los mensajes recibidos por el socket desde el servidor y se encarga de imprimirlos en pantalla.\n<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"c\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">void receptor()\n{\n    char message[LENGTH] = {};\n    while (1)\n    {\n        int receive = recv(sockfd, message, LENGTH, 0); \/\/recibe los mensajes del servidor\n        if (receive > 0)\n        {\n            printf(\"%s\", message); \/\/Imprime los mensajes del servidor\n            reset_stdout();  \/\/ Vac\u00eda el b\u00fafer de salida.\n        }\n        else if (receive == 0)\n        {\n            break;\n        }\n        else\n        {\n            \/\/ -1\n        }\n        memset(message, 0, sizeof(message)); \/\/resetea el buffer de mensajes\n    }\n}\n<\/pre>\n\n\n\n<p class=\"has-text-align-justify\">Y as\u00ed cada vez que realice una nueva entrada, est\u00e9 while infinito, enviar\u00e1 los mensajes, ya formateados con el nombre del emisor al servidor.<\/p>\n\n\n\n<p class=\"has-text-align-justify\">A continuaci\u00f3n en la <a href=\"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c-servidor\/\" title=\"Como crear una Sala de Chat en C \u2013 Servidor\">siguiente parte<\/a> del tutorial, empezaremos con el c\u00f3digo del servidor.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Creando el cliente El cliente es quien se conectar\u00e1 al servidor, quien enviar\u00e1 mensajes y recibir\u00e1 mensajes de otros clientes. En principio como debe ser una sala de chat. Librer\u00edas: Algunas de las librer\u00edas que estaremos utilizando seran estas: #include &lt;stdio.h&gt; &#8211; Contiene las definiciones de las macros, las constantes, <a href=\"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c-cliente\/\" class=\"read-more\">Seguir leyendo<i class=\"ion-ios-arrow-right read-more-right\"><\/i><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_mi_skip_tracking":false,"jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true,"jetpack_social_options":[]},"categories":[1],"tags":[6,8],"jetpack_publicize_connections":[],"aioseo_notices":[],"jetpack_featured_media_url":"","jetpack-related-posts":[{"id":1223,"url":"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c\/","url_meta":{"origin":1822,"position":0},"title":"Como crear una Sala de Chat en C","date":"diciembre 6, 2019","format":false,"excerpt":"Aprende a programar una sala de chat hasta para 100 usuarios. Con el lenguaje C y las tecnologias de Sockets y Threads podras lograrlo.","rel":"","context":"En \u00abarticulo\u00bb","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2019\/12\/network.jpg?fit=1200%2C675&resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1844,"url":"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c-final\/","url_meta":{"origin":1822,"position":1},"title":"Como crear una Sala de Chat en C \u2013 Final","date":"diciembre 6, 2019","format":false,"excerpt":"Felicidades a todos los que llegaron hasta esta parte del tutorial, ahora vamos a ver en acci\u00f3n el proyecto final y como puedes ejecutarlo. Como saben dentro de los requisitos de este proyecto, era necesario tener un sistema linux ya que el programa utiliza librer\u00edas propias del sistema y en\u2026","rel":"","context":"En \u00abc\u00bb","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2021\/07\/chat_resultado.jpg?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1169,"url":"http:\/\/3.214.197.113\/2019\/como-crear-una-libreria-en-c-c\/","url_meta":{"origin":1822,"position":2},"title":"Como crear una Librer\u00eda en C\/C++","date":"diciembre 3, 2019","format":false,"excerpt":"Un tutorial muy sencillo y explicativo sobre como crear una libreria para nuestros proyectos de programacion con C y C++.","rel":"","context":"En \u00abarticulo\u00bb","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2019\/12\/Fondo-HD.jpg?fit=1200%2C675&resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1832,"url":"http:\/\/3.214.197.113\/2019\/crea-una-servidor-de-sala-de-chat-en-c-servidor\/","url_meta":{"origin":1822,"position":3},"title":"Como crear una Sala de Chat en C &#8211; Servidor","date":"diciembre 6, 2019","format":false,"excerpt":"Creando el Servidor Parte 1 Parte 2 Parte 3 Parte 4 Descargar c\u00f3digo El servidor en este proyecto, funciona como broker de mensajes, repartiendo los mensajes entre todos los clientes menos al emisor original. Es el encargado de decidir el puerto al cual se conectar\u00e1n los clientes. Funciones: Este c\u00f3digo\u2026","rel":"","context":"En \u00abc\u00bb","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1749,"url":"http:\/\/3.214.197.113\/2020\/7-librerias-para-python-que-deberias-conocer\/","url_meta":{"origin":1822,"position":4},"title":"Las 7 Librer\u00edas mas importantes de Python","date":"marzo 6, 2020","format":false,"excerpt":"Python es un mundo de paquetes y librer\u00edas interesantes, muchas solucionan problemas comunes de los programadores, seguro no conoc\u00edas alguna de las librer\u00edas de esta lista.","rel":"","context":"En \u00abarticulo\u00bb","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2020\/03\/Banner-Horizontal-Librerias-Python.png?fit=1200%2C675&resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1849,"url":"http:\/\/3.214.197.113\/2020\/aprende-7-trucos-que-quizas-no-conocias-de-python\/","url_meta":{"origin":1822,"position":5},"title":"7 Trucos que deber\u00edas saber de Python","date":"agosto 28, 2020","format":false,"excerpt":"Aumenta tus habilidades de desarrollador con estos trucos en python que tal vez no conoc\u00edas y pueden ser muy \u00fatiles para tu d\u00eda a d\u00eda.","rel":"","context":"En \u00abarticulo\u00bb","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/3.214.197.113\/wp-content\/uploads\/2021\/07\/Banner-Horizontal-Trucos-en-python.png?fit=1200%2C675&resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/posts\/1822"}],"collection":[{"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/comments?post=1822"}],"version-history":[{"count":0,"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/posts\/1822\/revisions"}],"wp:attachment":[{"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/media?parent=1822"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/categories?post=1822"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/3.214.197.113\/wp-json\/wp\/v2\/tags?post=1822"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}